!function(){var e=window.location.href,t="",a="",r="",s=MyLocalStorage.Cache.get("productChecked"),n=$.getUrlArgs(e).categoryid,o=MyLocalStorage.Cache.get("addressManage"),d="",i="";n&&(r="1",t=n,a=$.getUrlArgs(e).num),s&&(r="",t=s.productCheckedIdLists,a=s.productCheckedNumLists),o&&(MyLocalStorage.Cache.remove("addressManage"),$(".submit-order-address-manage").show()),String.prototype.temp=function(e){return this.replace(/\$\w+\$/gi,function(t){var a=e[t.replace(/\$/g,"")];return a+""=="undefined"?"":a})};var c=$("#product-textarea").val(),l=$("#address-textarea").val(),u={init:function(){u.addShopInfo(),u.addAddress(),$(".submit-order-btn").on("click",u.submitOrderFun),$(".pay-btn").on("click",function(){$(this).attr("src","./images/select_after.png"),$(this).parents("li").siblings("li").find(".pay-btn").attr("src","./images/select_before.png"),$("#select_value").val($(this).attr("data"))}),$(".submit-order-address-top img").on("click",function(){$(".submit-order-address-manage").hide()}),$(".goto-address-manage").on("click",function(){MyLocalStorage.Cache.put("addressManage","1"),window.location.href="addressManage.html"})},addShopInfo:function(){for(var e=t.split(","),r=a.split(","),s={},n=0;n<e.length;n++)s[e[n]]=r[n];var o={goodsId:t};$.ajaxByPost("/goods/findGoodsIds",o,function(e){var t=e.data;console.log(t),$.each(t,function(e){var a="",r=t[e],n=r.goodsId;a=(a=c.temp(r)).replace(/#\w+#/gi,function(e){return MinImgUrl}),$(".submit-order-shop").append(a),$(".num-span"+n).html(s[n]),u.totalPrice(n)}),u.allPrice(),$("img.decreaseAmount").click(function(){u.calculateNum(1,$(this).attr("pid"))}),$("img.increaseAmount").click(function(){u.calculateNum(2,$(this).attr("pid"))})})},submitOrderFun:function(){var e=u.shopSelect();if(null==checkLogin||""==checkLogin)layer.msg("请先登录",{time:500},function(){window.location.href="login.html"});else if(""==i)layer.msg("请选择地址",{time:500});else{var t={token:checkLogin,goodsIds:e.productCheckedIdLists,goodsNum:e.productCheckedNumLists,orderPayType:$("#select_value").val(),orderShipAddress:i,userId:"",userInvite:$("#referee").val(),orderDegree:e.productOrderDegree};$.ajaxByPost("order/createOrder",t,function(e){e.data;console.log(e.code),200==e.code&&($(".submit-order-btn").unbind("click",u.submitOrderFun),layer.msg("提交成功"),MyLocalStorage.Cache.remove("productChecked"));var t={token:checkLogin};$.ajaxByPost("order/findOrderList",t,function(e){var t=e.data;console.log(t)})})}},addAddress:function(){var e={token:checkLogin};$.ajaxByPost("receiveAddress/findByLoginId",e,function(e){var t=e.data,a="";if(console.log(t),d=t,0!=t.length){var r=t[0];$("#name").html(r.addressName),$("#phone").html(r.addressTelephone),$("#address").html(r.addressComplete),i=r.addressId,$(".have-address").show(),$(".submit-order-addressno").hide(),$(".submit-order-address").on("click",function(){u.addressManage()}),t.forEach(function(e,t){a+=l.temp(e)})}else $(".goto-address-manage").html("添加"),$(".have-address").hide(),$(".submit-order-addressno").show(),$(".submit-order-addressno").on("click",function(){u.addressManage()});$(".submit-order-address-list").html(a),$(".submit-order-address-list li").eq(0).find("p").prepend('<span class="default-address">[默认地址]</span>'),$(".submit-order-address-list li").on("click",function(){$(this).find("p span").hide(),console.log($(this).find("p").html()),i=$(this).attr("data"),$("#name").html($(this).find(".float-left").html()),$("#phone").html($(this).find(".float-right").html()),$("#address").html($(this).find("p").html()),$(".submit-order-address-manage").hide(),$(this).find("p span").show()})})},shopSelect:function(){var e,a=[];$("[id^=num-span]").each(function(){var e=$(this).text();a.push(e)}),e=a.join(",");var s={};return s.productCheckedIdLists=t,s.productCheckedNumLists=e,s.productOrderDegree=r,s},addressManage:function(){0!=d.length?$(".submit-order-address-manage").show():window.location.href="addressManage.html"},changeSelectbg:function(e){console.log("点击"),$("[id^=pay]").each(function(){console.log($(this).attr("id").substring(3)),$(this).attr("id").substring(3)==e?$(this).attr("src","./images/select_after.png"):$(this).attr("src","./images/select_before.png")}),$("#select_value").val(e)},calculateNum:function(e,t){var a=parseInt($(".num-span"+t).html());1==e?(a-=1)<=0&&(a=1):2==e&&(a+=1),$(".num-span"+t).html(a),u.totalPrice(t)},totalPrice:function(e){var t=(100*parseFloat($("#price"+e).text())*parseInt($("#num-span"+e).text())/100).toFixed(2);$("#total-price"+e).html(t),u.allPrice()},allPrice:function(){var e=0,t=0;$("[id^=total-price]").each(function(){e+=100*parseFloat($(this).text())}),$("[id^=num-span]").each(function(){t+=parseInt($(this).text())}),$("#all-price").html((e/100).toFixed(2)),$("#all-num").html(t)}};$(u.init())}();