$(function(){String.prototype.temp=function(e){return this.replace(/\$\w+\$/gi,function(t){if(null==e[t.replace(/\$/g,"")])return t;var a=e[t.replace(/\$/g,"")];return a+""=="undefined"?"":a})};var e="",t=$("textarea").val(),a={token:checkLogin};null==checkLogin||""==checkLogin?window.location.href="login.html":$.ajaxByPost("shopingCart/findAllCart",a,function(a){if(200===a.code){var n=a.data;n.length>0?n.forEach(function(a,s){e+=t.temp(n[s]).temp(n[s].goods)}):layer.msg("您还没有添加任何商品进入购物车哦")}if(e=e.replace(/#\w+#/gi,function(e){return MinImgUrl}),$(".list-shop-cart").html(e),e.length>0){var s=$('input[type="checkbox"]'),c=$(".whole_check"),i=$(".son_check"),l=$(".list-shop-cart .container-package"),r=$(".list-shop-cart .container-package").length,o=document.getElementById("delete-all"),h=$("#settlement");$(".text-shop-cart .text-num").html(r),i.each(function(){var e=i.length,t=0;$(this).is(":checked")&&t++,t==e?(c.prop("checked",!0),c.next("label").addClass("mark")):(c.prop("checked",!1),c.next("label").removeClass("mark"))});for(var d=0;d<l.length;d++){$(l[d]).on("click",".add,.minus,.btn-delete",function(){var e=$(this).attr("class").split(" ")[0],t=($(this).parents(".amount_box").find(".minus"),$(this).parent().find("input")[0]),a=parseInt(t.value);switch(e){case"add":t.value=a+1;break;case"minus":a>1&&(t.value=a-1);break;case"btn-delete":var n=$(this).attr("id").substring(7),s={token:checkLogin,goodsId:n},c=$(this);layer.confirm("确定删除此商品吗？",{title:!1,closeBtn:0,yes:function(e,t){$.ajaxByPost("shopingCart/deleteCart",s,function(e){200===e.code&&c.remove()}),layer.close(e)}})}p()});var u=[];o.onclick=function(){var e=$("input[type=checkbox]:checked"),t=e.parents(".container-package");if($(".text-shop-cart .text-num").html(r-t.length),e.length>0){for(var a=0;a<e.length;a++)"all"!=$(e[a]).attr("id")&&u.push($(e[a]).attr("productId"));var n={token:checkLogin,goodsId:u.join(",")};layer.confirm("确定删除此商品吗？",{title:!1,closeBtn:0,yes:function(e,a){$.ajaxByPost("shopingCart/deleteCart",n,function(e){200===e.code&&t.remove()}),layer.close(e)}}),p()}else layer.msg("请选择要删除的商品！")},l[d].getElementsByTagName("input")[1].onkeyup=function(){var e=parseInt(this.value);(isNaN(e)||e<=0)&&(e=1),this.value!=e&&(this.value=e),p()}}function p(){var e=0,t=0;i.each(function(){if($(this).is(":checked")){var a=$(this).parents().siblings(".box-product-info").find(".btns-deal-product-amount em").html().substring(1),n=$(this).parents().siblings(".box-product-info").find(".btns-deal-product-amount .sum").val();e+=parseInt(n)*parseFloat(a),t+=parseInt(n)}}),0!=e?$(".sum-price").html("￥"+e.toFixed(2)):$(".sum-price").html("0.00"),$("#settlement .num").html(t),0!=e&&0!=t?$(h).hasClass("btn_sty")||$(h).addClass("btn_sty"):$(h).hasClass("btn_sty")&&$(h).removeClass("btn_sty")}s.click(function(){$(this).is(":checked")?"all"===$(this).attr("id")?(s.prop("checked",!0),s.next("label").addClass("mark")):$(this).next("label").addClass("mark"):"all"===$(this).attr("id")?(s.prop("checked",!1),s.next("label").removeClass("mark")):$(this).next("label").removeClass("mark"),p()}),h.click(function(){var e={},t="",a="",n=$("input[type=checkbox]:checked");if(n.length>0)for(var s=0;s<n.length;s++)"all"!=$(n[s]).attr("id")&&(t+=$(n[s]).attr("productId")+",",a+=$(n[s]).parents(".container-package").find(".sum").val()+",",e.productCheckedIdLists=t.substring(0,t.lastIndexOf(",")),e.productCheckedNumLists=a.substring(0,a.lastIndexOf(",")),MyLocalStorage.Cache.put("productChecked",e,60),window.location.href="submitOrder.html");else layer.msg("你还没用选中哦")}),i.each(function(){$(this).click(function(){if($(this).is(":checked")){var e=i.length,t=0;i.each(function(){$(this).is(":checked")&&t++}),t==e&&(c.prop("checked",!0),c.next("label").addClass("mark"))}else c.prop("checked",!1),c.next("label").removeClass("mark");p()})})}})});